let userId=1,otherUserId=2;var restaurantChoices={choice1:null,choice2:null};let baseURL="https://bnqukaif.apiadmin.co.uk/api/";var database,restaurants=null;function getRestaurants(){showWaiting(),getApiRequest("restaurants").then(function(e){restaurants=e.Restaurants,setUpRestaurants(),setUpRecommendations(),hideWaiting(),$("#recommendations").show()})}function setUpRecommendations(){$(".recommendation").click(function(e){var s=parseInt(this.dataset.value);if(null===restaurantChoices.choice1)restaurantChoices.choice1=s,this.classList.add("first");else if(s!==restaurantChoices.choice1){restaurantChoices.choice2=s,writeRestaurantData(userId),$("#recommendations").hide(),showWaiting(),database.ref("users/"+otherUserId+"/restaurants").on("value",function(e){e.val()?setUpWinningRestaurant():$("#restaurant").hide()})}})}function showWaiting(){$("#waiting").show()}function hideWaiting(){$("#waiting").hide()}function setUpRestaurants(){$("#recommendations").append('<div class="people container-fluid"><img src="/content/img/people.png" alt="People"><p>Your results</p><h2>Pick <b>two</b> of the three options below</h2>'),restaurants.forEach(e=>{$("#recommendations").append('<div class="row"><div class="col-12"><div class="card"><div class="container-fluid"><div class="row"><div class="col-3"><img class="img-fluid" src="'+e.Image+'" /></div><div class="col-6 restaurantInfo"><h4><b>'+e.Name+"</b></h4><p>"+e.AverageRating+"</p><p>"+e.FoodType+'</p></div><div class="col-3"><img src="/content/img/justeat.png" class="right source" /></div></div><div class="row"><div class="col-6"><p>'+e.Address+" "+e.Postcode+"</p><p>"+e.DeliveryDetails+'</p></div><div class="col-6"><div class="row right"><button type="button" class="btn btn-success recommendation" data-value="'+e.Id+'">Select</button></div></div></div></div></div></div></div>')})}function setUpWinningRestaurant(){database.ref("/users/"+userId).once("value").then(function(e){database.ref("/users/"+otherUserId).once("value").then(function(s){var t=e.val().restaurants,a=s.val().restaurants;getMenu(t.choice1===a.choice1?t.choice1:t.choice1===a.choice2?t.choice1:t.choice2).then(function(){hideWaiting(),$("#restaurant").show()})})})}function getApiRequest(e){return $.get(`${baseURL}${e}`)}function getMenu(e){return getApiRequest("restaurant"+e).then(function(e){var s="";e.Products.forEach(e=>{s+=`<div class='product ${e.IsVegetarian?"vegetarian":""}' id='product${e.Id}'><img src='/content/img/remove.png'><h3>${e.Item+(e.Quantity>1?` x${e.Quantity}`:"")}</h3> <img src="/content/img/swap.png" class="swap"> <p class='price'>&pound;${e.Price}</p> <p class="productInfo"> ${e.Info}</p></div>`}),$("#restaurant").append('<div class="row"><div class="col-12"><div class="card"><div class="container-fluid"><div class="row"><div class="col-3"><img class="img-fluid" src="'+e.Image+'" /></div><div class="col-6 restaurantInfo"><h4><b>'+e.Name+"</b></h4><p>"+e.AverageRating+"</p><p>"+e.FoodType+'</p></div><div class="col-3"><img src="/content/img/justeat.png" class="right source" /></div></div><div class="row"><div class="col-8"><p>'+e.Address+" "+e.Postcode+"</p><p>"+e.DeliveryDetails+'</p></div></div><div class="row"><div class="col-12 addPadding"<p><strong>Picked for you</strong></p><p>If you don\'t like an item swap it for a new one</p><div class="products">'+s+'</div><div class="total-container"><p>Total</p><p class="price">&pound;'+e.TotalCost+'</p></div></div></div></div></div><div class="checkout"><button class="btn btn-primary">Checkout</button></div></div></div>')})}function writeRestaurantData(e){database.ref("users/"+e).set({restaurants:restaurantChoices})}$(document).ready(function(){firebase.initializeApp({apiKey:"AIzaSyB47VwRgy6QFWAl6uJeFEeO_dedKERTiM8",authDomain:"pickyapp-1.firebaseapp.com",databaseURL:"https://pickyapp-1.firebaseio.com",projectId:"pickyapp-1",storageBucket:"pickyapp-1.appspot.com",messagingSenderId:"779693509357"}),database=firebase.database(),$("#set-user-1").click(function(){userId=1,otherUserId=2,getRestaurants(),$("#user-set").hide()}),$("#set-user-2").click(function(){userId=2,otherUserId=1,getRestaurants(),$("#user-set").hide()})});